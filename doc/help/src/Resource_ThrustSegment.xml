<?xml version="1.0" encoding="UTF-8"?>
<refentry version="5.0" xml:id="ThrustSegment"
          xmlns="http://docbook.org/ns/docbook"
          xmlns:xlink="http://www.w3.org/1999/xlink"
          xmlns:xi="http://www.w3.org/2001/XInclude"
          xmlns:svg="http://www.w3.org/2000/svg"
          xmlns:m="http://www.w3.org/1998/Math/MathML"
          xmlns:html="http://www.w3.org/1999/xhtml"
          xmlns:db="http://docbook.org/ns/docbook">
  <indexterm>
    <primary>ThrustSegment</primary>
  </indexterm>

  <refmeta>
    <refentrytitle>ThrustSegment</refentrytitle>

    <refmiscinfo class="source">GMAT</refmiscinfo>

    <refmiscinfo class="manual">Resources</refmiscinfo>
  </refmeta>

  <refnamediv>
    <refname>ThrustSegment</refname>

    <refpurpose>One or more <guilabel>ThrustSegments</guilabel> define how
    data in a thrust history file are used.</refpurpose>
  </refnamediv>

  <refsection>
    <title>Description</title>

    <para>A <guilabel>ThrustSegment</guilabel> resource is used to define how
    a portion of data, encapsulated between the "BeginThrust
    {<guilabel>ThrustSegment</guilabel> object name}" and "EndThrust
    {<guilabel>ThrustSegment</guilabel> object name}" keywords, in a thrust
    history file is used.</para>

    <para><phrase role="ref_seealso">See Also</phrase>: <xref
    linkend="ThrustSegment"/>, <xref linkend="BeginFileThrust"/>, <xref
    linkend="EndFileThrust"/></para>
  </refsection>

  <refsection xml:id="ThrustSegment_Resource_Fields">
    <title>Fields</title>

    <informaltable colsep="0" frame="topbot">
      <tgroup cols="2">
        <colspec colwidth="383*"/>

        <colspec colwidth="617*"/>

        <thead>
          <row>
            <entry>Field</entry>

            <entry>Description</entry>
          </row>
        </thead>

        <tbody>
          <row>
            <entry><guilabel>ApplyThrustScaleToMassFlow</guilabel></entry>

            <entry><para>Flag specifying if the thrust/acceleration
            <guilabel>ThrustScaleFactor</guilabel> should also be applied to
            the mass flow rate. </para><variablelist>
                <varlistentry>
                  <term>Data Type</term>

                  <listitem>
                    <para>Boolean</para>
                  </listitem>
                </varlistentry>

                <varlistentry>
                  <term>Allowed Values</term>

                  <listitem>
                    <para>True, False</para>
                  </listitem>
                </varlistentry>

                <varlistentry>
                  <term>Access</term>

                  <listitem>
                    <para>set</para>
                  </listitem>
                </varlistentry>

                <varlistentry>
                  <term>Default Value</term>

                  <listitem>
                    <para><guilabel>False</guilabel></para>
                  </listitem>
                </varlistentry>

                <varlistentry>
                  <term>Units</term>

                  <listitem>
                    <para>N/A</para>
                  </listitem>
                </varlistentry>

                <varlistentry>
                  <term>Interfaces</term>

                  <listitem>
                    <para>script</para>
                  </listitem>
                </varlistentry>
              </variablelist></entry>
          </row>

          <row>
            <entry><guilabel>MassFlowScaleFactor </guilabel></entry>

            <entry><para>Multiplicative scale factor applied to mass flow rate
            data in the thrust history file. Only used if mass flow rate is
            being modeled in the thrust history file. </para><variablelist>
                <varlistentry>
                  <term>Data Type</term>

                  <listitem>
                    <para>Real</para>
                  </listitem>
                </varlistentry>

                <varlistentry>
                  <term>Allowed Values</term>

                  <listitem>
                    <para>Any Real number</para>
                  </listitem>
                </varlistentry>

                <varlistentry>
                  <term>Access</term>

                  <listitem>
                    <para>set</para>
                  </listitem>
                </varlistentry>

                <varlistentry>
                  <term>Default Value</term>

                  <listitem>
                    <para><guilabel>1.0</guilabel></para>
                  </listitem>
                </varlistentry>

                <varlistentry>
                  <term>Units</term>

                  <listitem>
                    <para>N/A</para>
                  </listitem>
                </varlistentry>

                <varlistentry>
                  <term>Interfaces</term>

                  <listitem>
                    <para>script</para>
                  </listitem>
                </varlistentry>
              </variablelist></entry>
          </row>

          <row>
            <entry><guilabel>MassSource</guilabel></entry>

            <entry><para>Fuel tank holding the propellant used when modeling
            the finite burn described in the thrust segment. GMAT will
            decrement the fuel mass contained in this tank according to the
            user-selected mass flow modeling options. If more than one tank is
            specified, only the first one is used.</para><variablelist>
                <varlistentry>
                  <term>Data Type</term>

                  <listitem>
                    <para>ChemicalTank</para>
                  </listitem>
                </varlistentry>

                <varlistentry>
                  <term>Allowed Values</term>

                  <listitem>
                    <para>{} or any user defined
                    <guilabel>ChemicalTank</guilabel> resource</para>
                  </listitem>
                </varlistentry>

                <varlistentry>
                  <term>Access</term>

                  <listitem>
                    <para>set</para>
                  </listitem>
                </varlistentry>

                <varlistentry>
                  <term>Default Value</term>

                  <listitem>
                    <para><guilabel>{}</guilabel></para>
                  </listitem>
                </varlistentry>

                <varlistentry>
                  <term>Units</term>

                  <listitem>
                    <para>N/A</para>
                  </listitem>
                </varlistentry>

                <varlistentry>
                  <term>Interfaces</term>

                  <listitem>
                    <para>script</para>
                  </listitem>
                </varlistentry>
              </variablelist></entry>
          </row>

          <row>
            <entry><guilabel>SolveFors</guilabel></entry>

            <entry><para>List of parameters to estimate.</para><variablelist>
                <varlistentry>
                  <term>Data Type</term>

                  <listitem>
                    <para>String</para>
                  </listitem>
                </varlistentry>

                <varlistentry>
                  <term>Allowed Values</term>

                  <listitem>
                    <para>{} or any combination of ThrustScaleFactor,
                    ThrustAngle1, and/or ThrustAngle2</para>
                  </listitem>
                </varlistentry>

                <varlistentry>
                  <term>Access</term>

                  <listitem>
                    <para>set</para>
                  </listitem>
                </varlistentry>

                <varlistentry>
                  <term>Default Value</term>

                  <listitem>
                    <para><guilabel>{}</guilabel></para>
                  </listitem>
                </varlistentry>

                <varlistentry>
                  <term>Units</term>

                  <listitem>
                    <para>N/A</para>
                  </listitem>
                </varlistentry>

                <varlistentry>
                  <term>Interfaces</term>

                  <listitem>
                    <para>script</para>
                  </listitem>
                </varlistentry>
              </variablelist></entry>
          </row>

          <row>
            <entry><guilabel>ThrustAngle1</guilabel></entry>

            <entry><para>Coefficients for the first angle correction to the
            thrust or acceleration vector. See Remarks below for more
            details.</para><variablelist>
                <varlistentry>
                  <term>Data Type</term>

                  <listitem>
                    <para>Real array</para>
                  </listitem>
                </varlistentry>

                <varlistentry>
                  <term>Allowed Values</term>

                  <listitem>
                    <para>Any Real number(s)</para>
                  </listitem>
                </varlistentry>

                <varlistentry>
                  <term>Access</term>

                  <listitem>
                    <para>set</para>
                  </listitem>
                </varlistentry>

                <varlistentry>
                  <term>Default Value</term>

                  <listitem>
                    <para><guilabel>[ 0.0 ] </guilabel></para>
                  </listitem>
                </varlistentry>

                <varlistentry>
                  <term>Units</term>

                  <listitem>
                    <para>deg, deg/sec, deg/sec^2 , ... (See Remarks
                    section)</para>
                  </listitem>
                </varlistentry>

                <varlistentry>
                  <term>Interfaces</term>

                  <listitem>
                    <para>script</para>
                  </listitem>
                </varlistentry>
              </variablelist></entry>
          </row>

          <row>
            <entry><guilabel>ThrustAngle1Sigma</guilabel></entry>

            <entry><para>Standard deviation(s) of
            <guilabel>ThrustAngle1</guilabel>. Only used if
            <guilabel>ThrustAngle1</guilabel> is defined as a solve-for (using
            the <guilabel>SolveFors</guilabel> parameter defined above). See
            Remarks below for more details.</para><variablelist>
                <varlistentry>
                  <term>Data Type</term>

                  <listitem>
                    <para>Real array</para>
                  </listitem>
                </varlistentry>

                <varlistentry>
                  <term>Allowed Values</term>

                  <listitem>
                    <para>Positive real number(s)</para>
                  </listitem>
                </varlistentry>

                <varlistentry>
                  <term>Access</term>

                  <listitem>
                    <para>set</para>
                  </listitem>
                </varlistentry>

                <varlistentry>
                  <term>Default Value</term>

                  <listitem>
                    <para><guilabel>[ 1e70 ] </guilabel></para>
                  </listitem>
                </varlistentry>

                <varlistentry>
                  <term>Units</term>

                  <listitem>
                    <para>deg, deg/sec, deg/sec^2 , ... (See Remarks
                    section)</para>
                  </listitem>
                </varlistentry>

                <varlistentry>
                  <term>Interfaces</term>

                  <listitem>
                    <para>script</para>
                  </listitem>
                </varlistentry>
              </variablelist></entry>
          </row>

          <row>
            <entry><guilabel>ThrustAngle2</guilabel></entry>

            <entry><para>Coefficients for the second angle correction to the
            thrust or acceleration vector. See Remarks below for more
            details.</para><variablelist>
                <varlistentry>
                  <term>Data Type</term>

                  <listitem>
                    <para>Real array</para>
                  </listitem>
                </varlistentry>

                <varlistentry>
                  <term>Allowed Values</term>

                  <listitem>
                    <para>Any Real number(s)</para>
                  </listitem>
                </varlistentry>

                <varlistentry>
                  <term>Access</term>

                  <listitem>
                    <para>set</para>
                  </listitem>
                </varlistentry>

                <varlistentry>
                  <term>Default Value</term>

                  <listitem>
                    <para><guilabel>[ 0.0 ] </guilabel></para>
                  </listitem>
                </varlistentry>

                <varlistentry>
                  <term>Units</term>

                  <listitem>
                    <para>deg, deg/sec, deg/sec^2 , ... (See Remarks
                    section)</para>
                  </listitem>
                </varlistentry>

                <varlistentry>
                  <term>Interfaces</term>

                  <listitem>
                    <para>script</para>
                  </listitem>
                </varlistentry>
              </variablelist></entry>
          </row>

          <row>
            <entry><guilabel>ThrustAngle2Sigma</guilabel></entry>

            <entry><para>Standard deviation(s) of
            <guilabel>ThrustAngle2</guilabel>. Only used if
            <guilabel>ThrustAngle2</guilabel> is defined as a solve-for (using
            the <guilabel>SolveFors</guilabel> parameter defined above). See
            Remarks below for more details.</para><variablelist>
                <varlistentry>
                  <term>Data Type</term>

                  <listitem>
                    <para>Real array</para>
                  </listitem>
                </varlistentry>

                <varlistentry>
                  <term>Allowed Values</term>

                  <listitem>
                    <para>Positive real number(s)</para>
                  </listitem>
                </varlistentry>

                <varlistentry>
                  <term>Access</term>

                  <listitem>
                    <para>set</para>
                  </listitem>
                </varlistentry>

                <varlistentry>
                  <term>Default Value</term>

                  <listitem>
                    <para><guilabel>[ 1e70 ] </guilabel></para>
                  </listitem>
                </varlistentry>

                <varlistentry>
                  <term>Units</term>

                  <listitem>
                    <para>deg, deg/sec, deg/sec^2 , ... (See Remarks
                    section)</para>
                  </listitem>
                </varlistentry>

                <varlistentry>
                  <term>Interfaces</term>

                  <listitem>
                    <para>script</para>
                  </listitem>
                </varlistentry>
              </variablelist></entry>
          </row>

          <row>
            <entry><guilabel>ThrustAngleConstraintVector</guilabel></entry>

            <entry><para>Vector which is used along with a vector in the
            direction of the thrust from the THF to define the coordinate
            system for the thrust angle rotations. See Remarks below for more
            details. </para><variablelist>
                <varlistentry>
                  <term>Data Type</term>

                  <listitem>
                    <para>Real array</para>
                  </listitem>
                </varlistentry>

                <varlistentry>
                  <term>Allowed Values</term>

                  <listitem>
                    <para>Real array (length three)</para>
                  </listitem>
                </varlistentry>

                <varlistentry>
                  <term>Access</term>

                  <listitem>
                    <para>set</para>
                  </listitem>
                </varlistentry>

                <varlistentry>
                  <term>Default Value</term>

                  <listitem>
                    <para><guilabel>[ 0 0 1 ] </guilabel></para>
                  </listitem>
                </varlistentry>

                <varlistentry>
                  <term>Units</term>

                  <listitem>
                    <para>N/A</para>
                  </listitem>
                </varlistentry>

                <varlistentry>
                  <term>Interfaces</term>

                  <listitem>
                    <para>script</para>
                  </listitem>
                </varlistentry>
              </variablelist></entry>
          </row>

          <row>
            <entry><guilabel>ThrustScaleFactor </guilabel></entry>

            <entry><para>Multiplicative scale factor applied to
            thrust/acceleration data in the thrust history
            file</para><variablelist>
                <varlistentry>
                  <term>Data Type</term>

                  <listitem>
                    <para>Real</para>
                  </listitem>
                </varlistentry>

                <varlistentry>
                  <term>Allowed Values</term>

                  <listitem>
                    <para>Any Real number</para>
                  </listitem>
                </varlistentry>

                <varlistentry>
                  <term>Access</term>

                  <listitem>
                    <para>set</para>
                  </listitem>
                </varlistentry>

                <varlistentry>
                  <term>Default Value</term>

                  <listitem>
                    <para>1.0</para>
                  </listitem>
                </varlistentry>

                <varlistentry>
                  <term>Units</term>

                  <listitem>
                    <para>N/A</para>
                  </listitem>
                </varlistentry>

                <varlistentry>
                  <term>Interfaces</term>

                  <listitem>
                    <para>script</para>
                  </listitem>
                </varlistentry>
              </variablelist></entry>
          </row>

          <row>
            <entry><guilabel>ThrustScaleFactorSigma</guilabel></entry>

            <entry><para>Standard deviation of
            <guilabel>ThrustScaleFactor</guilabel>. Only used if
            <guilabel>ThrustScaleFactor</guilabel> is defined as a solve-for
            (using the <guilabel>SolveFors</guilabel> parameter defined above)
            </para><variablelist>
                <varlistentry>
                  <term>Data Type</term>

                  <listitem>
                    <para>Real</para>
                  </listitem>
                </varlistentry>

                <varlistentry>
                  <term>Allowed Values</term>

                  <listitem>
                    <para>Positive real number</para>
                  </listitem>
                </varlistentry>

                <varlistentry>
                  <term>Access</term>

                  <listitem>
                    <para>set</para>
                  </listitem>
                </varlistentry>

                <varlistentry>
                  <term>Default Value</term>

                  <listitem>
                    <para><guilabel>1e70</guilabel></para>
                  </listitem>
                </varlistentry>

                <varlistentry>
                  <term>Units</term>

                  <listitem>
                    <para>N/A</para>
                  </listitem>
                </varlistentry>

                <varlistentry>
                  <term>Interfaces</term>

                  <listitem>
                    <para>script</para>
                  </listitem>
                </varlistentry>
              </variablelist></entry>
          </row>
        </tbody>
      </tgroup>
    </informaltable>
  </refsection>

  <refsection>
    <title>Remarks</title>

    <refsection xml:id="ThrustSegment_Remarks_ThrustAngleEstimation">
      <title>Overview of Thrust Angle Corrections</title>

      <para>The ThrustSegment supports small angle corrections to account for
      a misalignment in the thrust or acceleration vector defined in the
      thrust history file. The correction is applied by a two angle rotation
      about a coordinate system. Each angle is defined by a time varying
      polynomial: θ = a<subscript>0</subscript> + a<subscript>1</subscript>t +
      a<subscript>2</subscript>t<superscript>2</superscript> + ... +
      a<subscript>n</subscript>t<superscript>n</superscript>, with
      coefficients provided by the user via the fields
      <guilabel>ThrustAngle1</guilabel>, and
      <guilabel>ThrustAngle2</guilabel>, and time is measured as the seconds
      after the initial epoch of the <guilabel>ThrustSegment</guilabel>. The
      order of the polynomial is determined by the length of the arrays
      <guilabel>ThrustAngle1</guilabel>, and
      <guilabel>ThrustAngle2</guilabel>, and the user has a free choice in the
      length of this array.</para>

      <para>The angle corrections are applied as two subsequent rotations to
      the thrust or acceleration vector about two orthogonal axes. All vectors
      are defined in the coordinate system specified in the
      <guilabel>ThrustSegment</guilabel> in the thrust history file. The first
      rotation is applied about the axis formed by the cross product of the
      vector aligned with the thrust or acceleration vector and the vector
      specified by <guilabel>ThrustAngleConstraintVector</guilabel>. The
      second rotation axis is aligned with the vector defined by the cross
      product of the first rotation axis vector and the direction the thrust
      vector points after the first angle rotation. For example, if the thrust
      history file specifies a thrust along the +X axis in the spacecraft body
      frame, choosing a constraint vector of [ 0 0 1 ] (also taken to be in
      body coordinates) will map <guilabel>ThrustAngle1</guilabel> to a
      rotation about the body -Y axis (equivalent to a pitch angle), and
      <guilabel>ThrustAngle2</guilabel> will map to a rotation about the body
      +Z axis (equivalent to a yaw angle).</para>

      <refsection>
        <title>Solving for Thrust Angles</title>

        <para>When solving for a thrust angle, GMAT will solve for each
        polynomial coefficient specified in <guilabel>ThrustAngle1</guilabel>
        or <guilabel>ThrustAngle2</guilabel>, provided they are listed in the
        <guilabel>SolveFors</guilabel> field. The
        <guilabel>ThrustAngle1Sigma</guilabel> and
        <guilabel>ThrustAngle2Sigma</guilabel> fields contain the arrays of
        the a priori standard deviations for each coefficient in the
        corresponding angles field. When using the
        <guilabel>BatchEstimator</guilabel>, the user must also set the
        <guilabel>BatchEstimator</guilabel>
        <guilabel>UseInitialCovariance</guilabel> parameter to
        <guilabel>True</guilabel> for the thrust angle sigmas to be applied.
        The user can confirm the sigmas are applied by looking at the
        Estimation Initial Conditions report in the batch estimator output
        report file. The specified thrust angle sigmas are always
        automatically used by the
        <guilabel>ExtendedKalmanFilter</guilabel>.</para>

        <note>
          <para>The partial derivatives with respect to the angle coefficients
          are highly non-linear. When solving for thrust angles, care needs to
          be taken with respect to the order of the polynomials, the thrust
          angle uncertainties, and a priori values chosen. Convergence can
          become difficult if too high a polynomial order is used, if there
          are an insufficient number of observations during the thrust
          segment, or if the a priori angles are too far from the true
          misalignment angles. Using too large a value for the thrust angle
          sigmas can give too much freedom to the estimator to converge on for
          the coefficient values. Constraining the estimation by using the
          ThrustAngle sigmas (and setting <guilabel>BatchEstimator</guilabel>
          <guilabel>UseInitialCovariance</guilabel> to
          <guilabel>True</guilabel>) can aid convergence by restricting the
          freedom of the estimator, but this generally requires that the user
          have a good a priori knowledge of the thrust angles and their
          coefficients. These effects are additionally compounded by the
          periodic nature of angles such that an angle of 360 degrees is
          equivalent to an angle of 0 degrees.</para>
        </note>
      </refsection>

      <refsection>
        <title>Units for Thrust Angles and Thrust Angle Sigmas</title>

        <para>Because the values for <guilabel>ThrustAngle1</guilabel>,
        <guilabel>ThrustAngle2</guilabel>,
        <guilabel>ThrustAngle1Sigma</guilabel>, and
        <guilabel>ThrustAngle2Sigma</guilabel> are coefficients for a
        polynomial, the units depend on what element they are in the array.
        The first element in each array has units of degrees, and the next
        element has units of degrees/seconds. Each additional element has an
        additional "seconds" in the denominator.</para>
      </refsection>
    </refsection>
  </refsection>

  <refsection>
    <title>Examples</title>

    <informalexample>
      <para>Create a <guilabel>ThrustSegment</guilabel> where the thrust scale
      factor, with a value of 2.0, will also be applied to the mass flow
      rate.</para>

      <programlisting><code>Create Spacecraft aSat
Create ChemicalTank aTank
aSat.Tanks = {aTank}

Create ThrustSegment aThrustSegment;  
aThrustSegment.ThrustScaleFactor = 2.0;
aThrustSegment.ApplyThrustScaleToMassFlow = True; 
aThrustSegment.MassFlowScaleFactor = 1.5;
aThrustSegment.MassSource={aTank};

BeginMissionSequence</code></programlisting>

      <para>If you use the script snippet above to create a full script, you
      will need to create a thrust/acceleration and mass flow rate input file.
      Suppose the mass flow rate for a given instant of time is set to 1 kg/s
      in the file, what is the actual mass flow rate applied to the
      spacecraft? We need to take into account the values of
      <code>ThrustScaleFactor</code>, <code>MassFlowScaleFactor</code>, and
      <code>ApplyThrustScaleToMassFlow</code> before we can answer this
      question. In all cases, <code>MassFlowScaleFactor</code> is applied to
      the mass flow rate value given in the file. In this example, since
      <code>ApplyThrustScaleToMassFlow</code> is set to <code>True</code>, the
      <code>ThrustScaleFactor</code> will also be applied to the mass flow
      rate value given in the file. Thus, to answer our question, in this
      example, the actual mass flow rate applied to the spacecraft is
      <code>MassFlowScaleFactor</code>*<code>ThrustScaleFactor</code>*1 kg/s
      equals 3 kg/s. In the example above, the actual thrust/acceleration
      profile actually applied to the spacecraft is
      <code>(ThrustScaleFactor</code> = 2.0) times the thrust/acceleration
      given in the input file.</para>

      <para>For a complete example of how the
      <guilabel>ThrustHistoryFile</guilabel> and
      <guilabel>ThrustSegment</guilabel> resources are used to apply a
      thrust/acceleration and mass flow rate profile to a spacecraft, see the
      first example in the <xref linkend="BeginFileThrust"/> Help.</para>
    </informalexample>
  </refsection>
</refentry>
