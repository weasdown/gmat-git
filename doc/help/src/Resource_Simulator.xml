<?xml version="1.0" encoding="UTF-8"?>
<refentry version="5.0" xml:id="Simulator"
          xmlns="http://docbook.org/ns/docbook"
          xmlns:xlink="http://www.w3.org/1999/xlink"
          xmlns:xi="http://www.w3.org/2001/XInclude"
          xmlns:svg="http://www.w3.org/2000/svg"
          xmlns:m="http://www.w3.org/1998/Math/MathML"
          xmlns:html="http://www.w3.org/1999/xhtml"
          xmlns:db="http://docbook.org/ns/docbook">
  <indexterm>
    <primary>Simulator</primary>
  </indexterm>

  <indexterm>
    <primary>Tracking Data</primary>

    <secondary>Simulation</secondary>
  </indexterm>

  <refmeta>
    <refentrytitle>Simulator</refentrytitle>

    <refmiscinfo class="source">GMAT</refmiscinfo>

    <refmiscinfo class="manual">Resources</refmiscinfo>
  </refmeta>

  <refnamediv>
    <refname>Simulator</refname>

    <refpurpose>Configures the generation of simulated tracking data
    measurements.</refpurpose>
  </refnamediv>

  <refsection>
    <title>Description</title>

    <para>A <guilabel>Simulator</guilabel> configures the generation of
    simulated tracking data measurements. These measurements can then be used
    by a <guilabel>BatchEstimator</guilabel> resource as part of an estimation
    run.</para>

    <para>The <guilabel>Simulator</guilabel> object requires specification of
    one or more instances of a <guilabel>TrackingFileSet</guilabel> resource
    which identify the specific tracking data observation strands, data types,
    desired measurement corrections, and the output tracking data file name.
    Simulated data will be written in the GMAT Measurement Data (GMD) ASCII
    tracking data format. You must additionally specify a time span for the
    simulation run and a time interval between simulated observations.
    Simulated observations are only generated when a tracking strand meets the
    visibility constraints of all objects in the strand (for example, the
    observation must be above the ground station minimum elevation mask).
    Additionally, you must configure and specify an instance of a
    <guilabel>Propagator</guilabel> for the simulator. Finally, you can choose
    to add random Gaussian white noise to the generated measurements or to
    generate measurements without noise. If the
    <guilabel>Simulator.AddNoise</guilabel> option is set to On, noise with
    the standard deviation specified on each measurement strandâ€™s
    <guilabel>GroundStation.ErrorModel</guilabel>, is added to the
    measurements.</para>

    <para><phrase role="ref_seealso">See Also</phrase>: <xref
    linkend="TrackingFileSet"/>, <xref linkend="RunEstimator"/></para>
  </refsection>

  <refsection>
    <title>Fields</title>

    <informaltable colsep="0" frame="topbot">
      <tgroup cols="2">
        <colspec colnum="1" colwidth="1.0*"/>

        <colspec colnum="2" colwidth="3*"/>

        <thead>
          <row>
            <entry>Field</entry>

            <entry>Description</entry>
          </row>
        </thead>

        <tbody>
          <row>
            <entry><guilabel>AddData</guilabel></entry>

            <entry><para>A list of one or more
            <guilabel>TrackingFileSets.</guilabel></para><variablelist>
                <varlistentry>
                  <term>Data Type</term>

                  <listitem>
                    <para><guilabel>TrackingFileSet</guilabel> object</para>
                  </listitem>
                </varlistentry>

                <varlistentry>
                  <term>Allowed Values</term>

                  <listitem>
                    <para>Any valid <guilabel>TrackingFileSet</guilabel>
                    object</para>
                  </listitem>
                </varlistentry>

                <varlistentry>
                  <term>Access</term>

                  <listitem>
                    <para>set</para>
                  </listitem>
                </varlistentry>

                <varlistentry>
                  <term>Default Value</term>

                  <listitem>
                    <para><guilabel>None</guilabel></para>
                  </listitem>
                </varlistentry>

                <varlistentry>
                  <term>Units</term>

                  <listitem>
                    <para>N/A</para>
                  </listitem>
                </varlistentry>

                <varlistentry>
                  <term>Interfaces</term>

                  <listitem>
                    <para>script</para>
                  </listitem>
                </varlistentry>
              </variablelist></entry>
          </row>

          <row>
            <entry><guilabel>AddNoise</guilabel></entry>

            <entry><para>If true, adds noise to simulated
            observations.</para><variablelist>
                <varlistentry>
                  <term>Data Type</term>

                  <listitem>
                    <para>Boolean</para>
                  </listitem>
                </varlistentry>

                <varlistentry>
                  <term>Allowed Values</term>

                  <listitem>
                    <para>true, false, on, off</para>
                  </listitem>
                </varlistentry>

                <varlistentry>
                  <term>Access</term>

                  <listitem>
                    <para>set</para>
                  </listitem>
                </varlistentry>

                <varlistentry>
                  <term>Default Value</term>

                  <listitem>
                    <para><guilabel>false</guilabel></para>
                  </listitem>
                </varlistentry>

                <varlistentry>
                  <term>Units</term>

                  <listitem>
                    <para>N/A</para>
                  </listitem>
                </varlistentry>

                <varlistentry>
                  <term>Interfaces</term>

                  <listitem>
                    <para>script</para>
                  </listitem>
                </varlistentry>
              </variablelist></entry>
          </row>

          <row>
            <entry><guilabel>EpochFormat</guilabel></entry>

            <entry><para>Epoch format of both the initial and final
            epoch.</para><variablelist>
                <varlistentry>
                  <term>Data Type</term>

                  <listitem>
                    <para>STRING_TYPE</para>
                  </listitem>
                </varlistentry>

                <varlistentry>
                  <term>Allowed Values</term>

                  <listitem>
                    <para>A1ModJulian, TAIModJulian, UTCModJulian,
                    TTModJulian, TDBModJulian, A1Gregorian, TAIGregorian,
                    TTGregorian, UTCGregorian, TDBGregorian</para>
                  </listitem>
                </varlistentry>

                <varlistentry>
                  <term>Access</term>

                  <listitem>
                    <para>set</para>
                  </listitem>
                </varlistentry>

                <varlistentry>
                  <term>Default Value</term>

                  <listitem>
                    <para><guilabel>TAIModJulian</guilabel></para>
                  </listitem>
                </varlistentry>

                <varlistentry>
                  <term>Units</term>

                  <listitem>
                    <para>N/A</para>
                  </listitem>
                </varlistentry>

                <varlistentry>
                  <term>Interfaces</term>

                  <listitem>
                    <para>script</para>
                  </listitem>
                </varlistentry>
              </variablelist></entry>
          </row>

          <row>
            <entry><guilabel>InitialEpoch</guilabel></entry>

            <entry><para>The initial (start) epoch of the data simulation
            span. In the GMAT script, the <guilabel>EpochFormat</guilabel>
            field needs to be set before this field is set.
            </para><variablelist>
                <varlistentry>
                  <term>Data Type</term>

                  <listitem>
                    <para>STRING_TYPE</para>
                  </listitem>
                </varlistentry>

                <varlistentry>
                  <term>Allowed Values</term>

                  <listitem>
                    <para>Gregorian: 04 Oct 1957 12:00:00.000 &lt;= Epoch
                    &lt;= 28 Feb 2100 00:00:00.000</para>

                    <para>Modified Julian: 6116.0 &lt;= Epoch &lt;=
                    58127.5</para>
                  </listitem>
                </varlistentry>

                <varlistentry>
                  <term>Access</term>

                  <listitem>
                    <para>set</para>
                  </listitem>
                </varlistentry>

                <varlistentry>
                  <term>Default Value</term>

                  <listitem>
                    <para><guilabel>'21545'</guilabel></para>
                  </listitem>
                </varlistentry>

                <varlistentry>
                  <term>Units</term>

                  <listitem>
                    <para>N/A</para>
                  </listitem>
                </varlistentry>

                <varlistentry>
                  <term>Interfaces</term>

                  <listitem>
                    <para>script</para>
                  </listitem>
                </varlistentry>
              </variablelist></entry>
          </row>

          <row>
            <entry><guilabel>FinalEpoch</guilabel></entry>

            <entry><para>The final (ending) epoch of the data simulation span.
            In the GMAT script, the <guilabel>EpochFormat</guilabel> field
            needs to be set before this field is set. </para><variablelist>
                <varlistentry>
                  <term>Data Type</term>

                  <listitem>
                    <para>STRING_TYPE</para>
                  </listitem>
                </varlistentry>

                <varlistentry>
                  <term>Allowed Values</term>

                  <listitem>
                    <para>Gregorian: 04 Oct 1957 12:00:00.000 &lt;= Epoch
                    &lt;= 28 Feb 2100 00:00:00.000</para>

                    <para>Modified Julian: 6116.0 &lt;= Epoch &lt;=
                    58127.5</para>
                  </listitem>
                </varlistentry>

                <varlistentry>
                  <term>Access</term>

                  <listitem>
                    <para>set</para>
                  </listitem>
                </varlistentry>

                <varlistentry>
                  <term>Default Value</term>

                  <listitem>
                    <para><guilabel>'21545'</guilabel></para>
                  </listitem>
                </varlistentry>

                <varlistentry>
                  <term>Units</term>

                  <listitem>
                    <para>N/A</para>
                  </listitem>
                </varlistentry>

                <varlistentry>
                  <term>Interfaces</term>

                  <listitem>
                    <para>script</para>
                  </listitem>
                </varlistentry>
              </variablelist></entry>
          </row>

          <row>
            <entry><guilabel>MeasurementTimeStep</guilabel></entry>

            <entry><para>Specifies time step in seconds between two
            consecutive simulated observations.</para><variablelist>
                <varlistentry>
                  <term>Data Type</term>

                  <listitem>
                    <para>Real</para>
                  </listitem>
                </varlistentry>

                <varlistentry>
                  <term>Allowed Values</term>

                  <listitem>
                    <para>Real &gt; 0</para>
                  </listitem>
                </varlistentry>

                <varlistentry>
                  <term>Access</term>

                  <listitem>
                    <para>set</para>
                  </listitem>
                </varlistentry>

                <varlistentry>
                  <term>Default Value</term>

                  <listitem>
                    <para><guilabel>60</guilabel></para>
                  </listitem>
                </varlistentry>

                <varlistentry>
                  <term>Units</term>

                  <listitem>
                    <para>seconds</para>
                  </listitem>
                </varlistentry>

                <varlistentry>
                  <term>Interfaces</term>

                  <listitem>
                    <para>script</para>
                  </listitem>
                </varlistentry>
              </variablelist></entry>
          </row>

          <row>
            <entry><guilabel>Propagator</guilabel></entry>

            <entry><para>Name of <guilabel>Propagator</guilabel> object used
            to advance a spacecraft through time. Optionally, a separate
            <guilabel>Propagator</guilabel> field can be used to identify the
            propagator for specific spacecraft in the simulator's
            configuration, as described below. </para><variablelist>
                <varlistentry>
                  <term>Data Type</term>

                  <listitem>
                    <para>Valid <guilabel>Propagator</guilabel> object
                    optionally followed by a set of valid
                    <guilabel>Spacecraft</guilabel> objects.</para>
                  </listitem>
                </varlistentry>

                <varlistentry>
                  <term>Allowed Values</term>

                  <listitem>
                    <para>Any valid <guilabel>Propagator</guilabel> object
                    optionally followed by one or more
                    <guilabel>Spacecraft</guilabel> objects</para>

                    <para><emphasis>Propagator</emphasis>, or
                    <emphasis>{Propagator, Spacecraft[, Spacecraft2,
                    Spacecraft3, etc.]}</emphasis></para>
                  </listitem>
                </varlistentry>

                <varlistentry>
                  <term>Access</term>

                  <listitem>
                    <para>set</para>
                  </listitem>
                </varlistentry>

                <varlistentry>
                  <term>Default Value</term>

                  <listitem>
                    <para><guilabel>None</guilabel></para>
                  </listitem>
                </varlistentry>

                <varlistentry>
                  <term>Units</term>

                  <listitem>
                    <para>N/A</para>
                  </listitem>
                </varlistentry>

                <varlistentry>
                  <term>Interfaces</term>

                  <listitem>
                    <para>script</para>
                  </listitem>
                </varlistentry>
              </variablelist></entry>
          </row>
        </tbody>
      </tgroup>
    </informaltable>
  </refsection>

  <refsection>
    <title>Remarks</title>

    <note>
      <para>When configuring a numerical integrator for the simulator, you
      must use the fixed-step option. The <code>ErrorControl</code> parameter
      specified for the <guilabel>ForceModel</guilabel> resource associated
      with the <guilabel>Simulator</guilabel> <guilabel>Propagator</guilabel>
      must be set to '<code>None</code>.' Of course, when using fixed step
      control, the user must choose a step size, as given by the
      <guilabel>Propagator</guilabel> <code>InitialStepSize</code> field, for
      the chosen orbit regime and force profile, that yields the desired
      accuracy.</para>
    </note>

    <refsection>
      <title>Propagator Settings</title>

      <para>The <guilabel>Simulator</guilabel> resource has a
      <guilabel>Propagator</guilabel> field containing the name of the
      <guilabel>Propagator</guilabel> resource that will be used during the
      simulation process. The minimum step size, <guilabel>MinStep</guilabel>,
      of your propagator should always be set to 0.</para>

      <!--para>The <guilabel>Simulator</guilabel> resource uses the first
      <guilabel>Propagator</guilabel> identified as the default propagator for
      spacecraft that are simulated. The user can specify a different
      <guilabel>Propagator</guilabel> for specific spacecraft using an
      optional list of spacecraft assigned to other propagator components. An
      example of this usage is shown below.</para-->
    </refsection>

    <refsection>
      <title>Central Bodies Other Than Earth</title>

      <para>The GMAT simulator will account for central body occultations for
      spacecraft orbiting bodies other than the Earth. For example, for a
      Moon-centered spacecraft, simulated measurements will exclude any times
      when the line of sight between the spacecraft and the ground station is
      blocked by the Moon. Note however, that GMAT currently uses a spherical
      shape model for this occultation check. GMAT will use the polar radius
      of the central body when performing the occultation check and any body
      oblateness is ignored.</para>
    </refsection>

    <refsection>
      <title>Interactions</title>

      <informaltable colsep="0" frame="topbot">
        <tgroup cols="2">
          <colspec colwidth="169*"/>

          <colspec colwidth="831*"/>

          <thead>
            <row>
              <entry>Resource</entry>

              <entry>Description</entry>
            </row>
          </thead>

          <tbody>
            <row>
              <entry><guilabel>TrackingFileSet resource</guilabel></entry>

              <entry><para> Must be created in order to tell the
              <guilabel>Simulator</guilabel> resource, via the
              <guilabel>AddData</guilabel> field, which data types will be
              simulated and to specify the name of the output tracking data
              file (via <guilabel>FileName</guilabel>)</para></entry>
            </row>

            <row>
              <entry><guilabel>Propagator</guilabel>
              <guilabel>resource</guilabel></entry>

              <entry>Used by GMAT to generate the simulated orbit</entry>
            </row>

            <row>
              <entry><guilabel>RunSimulator command</guilabel></entry>

              <entry><para> Must use the <guilabel>RunSimulator</guilabel>
              command to actually create the data defined by the
              <guilabel>Simulator</guilabel> resource</para></entry>
            </row>
          </tbody>
        </tgroup>
      </informaltable>
    </refsection>
  </refsection>

  <refsection>
    <title>Examples</title>

    <informalexample>
      <para>The example below illustrates using the simulator to generate DSN
      range measurements. This example is more detailed than usual as it can
      actually be run to produce a file, <filename>simData.gmd</filename>,
      that contains a single range measurement for a fictional DSN ground
      station. For a more comprehensive example of simulating measurements,
      see the <xref linkend="Tut_Simulate_DSN_Range_and_Doppler_Data"/>
      tutorial.</para>

      <programlisting><?db-font-size 75% ?>%Create and Configure Spacecraft
Create Spacecraft SimSat;

SimSat.DateFormat  = UTCGregorian;
SimSat.Epoch       = '19 Aug 2015 00:00:00.000';
SimSat.X           = -126544963;      
SimSat.Y           = 61978518;       
SimSat.Z           = 24133225;     
SimSat.VX          = -13.789;
SimSat.VY          = -24.673;
SimSat.VZ          = -10.662;
SimSat.AddHardware = {SatTransponder, SatTranponderAntenna};

%Create and configure RF hardware
Create Antenna SatTranponderAntenna DSNReceiverAntenna DSNTransmitterAntenna;

Create Transponder SatTransponder;
SatTransponder.PrimaryAntenna = SatTranponderAntenna;

Create Transmitter DSNTransmitter;
DSNTransmitter.PrimaryAntenna = DSNTransmitterAntenna;
DSNTransmitter.Frequency      = 7200;

Create Receiver DSNReceiver;
DSNReceiver.PrimaryAntenna = DSNReceiverAntenna;

%Create and configure ground station and related error model
Create GroundStation DSN;
DSN.AddHardware = ...
  {DSNTransmitter, DSNReceiver, DSNTransmitterAntenna, DSNReceiverAntenna};
DSN.ErrorModels = {DSNrange};

Create ErrorModel DSNrange;
DSNrange.Type       = 'DSN_SeqRange';
DSNrange.NoiseSigma = 10;

%Define data types
Create TrackingFileSet simData;
simData.AddTrackingConfig = {{DSN,SimSat,DSN}, DSN_SeqRange};
simData.FileName          = {'simData.gmd'};

%   Create and configure the Simulator object
Create ForceModel FM1
FM1.ErrorControl = None   %Fixed step integration required for Navigation

Create Propagator prop;
prop.FM = FM1
prop.MinStep = 0          %For Navigation, allow propagator to take arbitrarily small steps   

Create Simulator sim;
sim.AddData             = {simData};
sim.Propagator          = prop;
sim.EpochFormat         = UTCGregorian;
sim.InitialEpoch        = '19 Aug 2015 08:00:00.000';
sim.FinalEpoch          = '19 Aug 2015 08:00:01.000';
sim.MeasurementTimeStep = 60;
sim.AddNoise            = On;

%  Mission Sequence - run the simulator.

BeginMissionSequence;

RunSimulator sim;</programlisting>
    </informalexample>

    <informalexample>
      <para>The next example shows how to script multiple propagators on a
      simulator. This example illustrates the scripting for propagators only,
      and does not include other object settings. In this example, the TDRS
      spacecraft are propagated using an ephemeris based SPICE propagator. Any
      other spacecraft used in the simulator are propagated using the satprop
      propagator.</para>

      <programlisting>%Create and Configure Spacecraft
Create Spacecraft SimSat;

Create Spacecraft TDRS6;
TDRS6.OrbitSpiceKernelName = {'TDRS6Ephem.bsp'};

Create Spacecraft TDRS10;
TDRS10.OrbitSpiceKernelName = {'TDRS10Ephem.bsp'};

%   Create and configure the Simulator object
Create ForceModel FM1

Create Propagator satprop;
satprop.FM = FM1
satprop.MinStep = 0

Create Propagator tdrsprop;
tdrsprop.Type        = SPK
tdrsprop.EpochFormat = 'A1ModJulian';
tdrsprop.StartEpoch  = 'FromSpacecraft';

Create Simulator sim;
sim.Propagator = satprop;
sim.Propagator = {tdrsprop, TDRS6, TDRS10};
</programlisting>
    </informalexample>
  </refsection>
</refentry>
