<?xml version="1.0" encoding="UTF-8"?>
<refentry version="5.0" xml:id="BeginFileThrust"
          xmlns="http://docbook.org/ns/docbook"
          xmlns:xlink="http://www.w3.org/1999/xlink"
          xmlns:xi="http://www.w3.org/2001/XInclude"
          xmlns:svg="http://www.w3.org/2000/svg"
          xmlns:m="http://www.w3.org/1998/Math/MathML"
          xmlns:html="http://www.w3.org/1999/xhtml"
          xmlns:db="http://docbook.org/ns/docbook">
  <indexterm>
    <primary>BeginFileThrust</primary>
  </indexterm>

  <refmeta>
    <refentrytitle>BeginFileThrust</refentrytitle>

    <refmiscinfo class="source">GMAT</refmiscinfo>

    <refmiscinfo class="manual">Commands</refmiscinfo>
  </refmeta>

  <refnamediv>
    <refname>BeginFileThrust</refname>

    <refpurpose>Apply a piece-wise continuous thrust/acceleration and mass
    flow rate profile</refpurpose>
  </refnamediv>

  <refsynopsisdiv>
    <title>Script Syntax</title>

    <synopsis><literal>BeginFileThrust</literal> <replaceable>aThrustHistoryFile</replaceable>(<replaceable>aSpacecraft</replaceable>)</synopsis>

    <synopsis><literal>EndFileThrust</literal> <replaceable>aThrustHistoryFile</replaceable>(<replaceable>aSpacecraft</replaceable>)</synopsis>
  </refsynopsisdiv>

  <refsection>
    <title>Description</title>

    <para>When you apply a <guilabel>BeginFileThrust</guilabel> command, you
    turn on the thrust/acceleration and mass flow rate profile given in the
    specified <guilabel>ThrustHistoryFile</guilabel> as applied to the
    specified <guilabel>Spacecraft</guilabel>. Similarly when you apply an
    <guilabel>EndFileThrust</guilabel> command, you turn off the
    thrust/acceleration and mass flow rate profile given in the specified
    <guilabel>ThrustHistoryFile</guilabel> as applied to the specified
    <guilabel>Spacecraft</guilabel>. In order to actually apply the
    thrust/acceleration and mass flow rate profile, there must be a
    <guilabel>Propagate</guilabel> command between the
    <guilabel>BeginFileThrust</guilabel> and
    <guilabel>End</guilabel><guilabel>FileThrust</guilabel> commands.</para>

    <para>To apply the<guilabel> BeginFileThrust</guilabel> and
    <guilabel>EndFileThrust</guilabel> commands, a
    <guilabel>ThrustHistoryFile</guilabel> object must be configured. This
    <guilabel>ThrustHistoryFile</guilabel> object, in turn, requires the
    configuration of one or more <guilabel>ThrustSegment</guilabel> objects.
    See the Remarks section and the examples below for a more detailed
    explanation.</para>

    <para><phrase role="ref_seealso">See Also</phrase>: <xref
    linkend="Spacecraft"/>, <xref linkend="ThrustHistoryFile"/>, <xref
    linkend="ThrustSegment"/>, <xref linkend="FuelTank"/></para>
  </refsection>

  <refsection>
    <title>Options</title>

    <informaltable colsep="0" frame="topbot">
      <tgroup cols="2">
        <colspec colnum="1" colwidth="2*"/>

        <colspec colnum="2" colwidth="3*"/>

        <thead>
          <row>
            <entry>Option</entry>

            <entry>Description</entry>
          </row>
        </thead>

        <tbody>
          <row>
            <entry><guilabel>BeginFileThrust -
            ThrustHistoryFile</guilabel></entry>

            <entry><para>Specifies the <guilabel>ThrustHistoryFile</guilabel>
            object activated by the <guilabel>BeginFileThrust</guilabel>
            command. </para> <variablelist>
                <varlistentry>
                  <term>Accepted Data Types</term>

                  <listitem>
                    <para>
                      <guilabel>ThrustHistoryFile</guilabel>
                    </para>
                  </listitem>
                </varlistentry>

                <varlistentry>
                  <term>Allowed Values</term>

                  <listitem>
                    <para><guilabel>ThrustHistoryFile</guilabel> object</para>
                  </listitem>
                </varlistentry>

                <varlistentry>
                  <term>Default Value</term>

                  <listitem>
                    <para>
                      <guilabel>N/A</guilabel>
                    </para>
                  </listitem>
                </varlistentry>

                <varlistentry>
                  <term>Required</term>

                  <listitem>
                    <para>yes</para>
                  </listitem>
                </varlistentry>

                <varlistentry>
                  <term>Interfaces</term>

                  <listitem>
                    <para>script</para>
                  </listitem>
                </varlistentry>
              </variablelist></entry>
          </row>

          <row>
            <entry><guilabel>BeginFileThrust - Spacecraft</guilabel></entry>

            <entry><para>Specifies the <guilabel>Spacecraft</guilabel> acted
            upon by the <guilabel>BeginFileThrust</guilabel> command. The
            mass/acceleration and mass flow rate profile specified by the
            <guilabel>ThrustFileHistory</guilabel> and applied to the
            <guilabel>Spacecraft</guilabel> will be activated. </para>
            <variablelist>
                <varlistentry>
                  <term>Accepted Data Types</term>

                  <listitem>
                    <para>
                      <guilabel>Spacecraf</guilabel>

                       

                      <guilabel>t</guilabel>
                    </para>
                  </listitem>
                </varlistentry>

                <varlistentry>
                  <term>Allowed Values</term>

                  <listitem>
                    <para><guilabel>Spacecraf</guilabel><guilabel>t
                    </guilabel>Object</para>
                  </listitem>
                </varlistentry>

                <varlistentry>
                  <term>Default Value</term>

                  <listitem>
                    <para>
                      <guilabel>N/A</guilabel>
                    </para>
                  </listitem>
                </varlistentry>

                <varlistentry>
                  <term>Required</term>

                  <listitem>
                    <para>yes</para>
                  </listitem>
                </varlistentry>

                <varlistentry>
                  <term>Interfaces</term>

                  <listitem>
                    <para>script</para>
                  </listitem>
                </varlistentry>
              </variablelist></entry>
          </row>

          <row>
            <entry><guilabel>EndFileThrust -
            ThrustHistoryFile</guilabel></entry>

            <entry><para>Specifies the <guilabel>ThrustHistoryFile</guilabel>
            object de-activated by the <guilabel>EndFileThrust</guilabel>
            command. </para> <variablelist>
                <varlistentry>
                  <term>Accepted Data Types</term>

                  <listitem>
                    <para>
                      <guilabel>ThrustHistoryFile</guilabel>
                    </para>
                  </listitem>
                </varlistentry>

                <varlistentry>
                  <term>Allowed Values</term>

                  <listitem>
                    <para><guilabel>ThrustHistoryFile</guilabel> object</para>
                  </listitem>
                </varlistentry>

                <varlistentry>
                  <term>Default Value</term>

                  <listitem>
                    <para>
                      <guilabel>N/A</guilabel>
                    </para>
                  </listitem>
                </varlistentry>

                <varlistentry>
                  <term>Required</term>

                  <listitem>
                    <para>yes</para>
                  </listitem>
                </varlistentry>

                <varlistentry>
                  <term>Interfaces</term>

                  <listitem>
                    <para>script</para>
                  </listitem>
                </varlistentry>
              </variablelist></entry>
          </row>

          <row>
            <entry><guilabel>EndFileThrust - Spacecraft</guilabel></entry>

            <entry><para>Specifies the <guilabel>Spacecraft</guilabel> acted
            upon by the <guilabel>EndFileThrust</guilabel> command. The
            mass/acceleration and mass flow rate profile specified by the
            <guilabel>ThrustFileHistory</guilabel> and applied to the
            <guilabel>Spacecraft</guilabel> will be de-activated. </para>
            <variablelist>
                <varlistentry>
                  <term>Accepted Data Types</term>

                  <listitem>
                    <para>
                      <guilabel>Spacecraft</guilabel>
                    </para>
                  </listitem>
                </varlistentry>

                <varlistentry>
                  <term>Allowed Values</term>

                  <listitem>
                    <para><guilabel>Spacecraft</guilabel> object</para>
                  </listitem>
                </varlistentry>

                <varlistentry>
                  <term>Default Value</term>

                  <listitem>
                    <para>
                      <guilabel>N/A</guilabel>
                    </para>
                  </listitem>
                </varlistentry>

                <varlistentry>
                  <term>Required</term>

                  <listitem>
                    <para>yes</para>
                  </listitem>
                </varlistentry>

                <varlistentry>
                  <term>Interfaces</term>

                  <listitem>
                    <para>script</para>
                  </listitem>
                </varlistentry>
              </variablelist></entry>
          </row>
        </tbody>
      </tgroup>
    </informaltable>
  </refsection>

  <refsection>
    <title>Remarks</title>

    <refsection>
      <title>Using <guilabel>BeginFileThrust</guilabel> and
      <guilabel>EndFileThrust</guilabel> commands</title>

      <para>To use the <guilabel>BeginFileThrust</guilabel> and
      <guilabel>EndFileThrust</guilabel> commands in your mission sequence,
      you must configure a <guilabel>ThrustHistoryFile</guilabel> object along
      with one or more <guilabel>ThrustSegment</guilabel> objects. In
      addition, if you wish to apply a mass flow rate profile, you must also
      create a <guilabel>ChemicalTank</guilabel> object. Additional details
      are provided in the steps below.</para>

      <orderedlist>
        <listitem>
          <para>Create a <guilabel>Spacecraft</guilabel> object whose
          thrust/acceleration and/or mass flow rate profile you wish to
          modify.</para>
        </listitem>

        <listitem>
          <para>If you wish to apply a mass flow rate profile, create and
          configure a <guilabel>ChemicalTank</guilabel> model. Add this
          <guilabel>ChemicalTank</guilabel> to the
          <guilabel>Spacecraft</guilabel> created in Step 1. The mass of the
          <guilabel>ChemicalTank</guilabel> will be changed according to the
          profile specified by the <guilabel>ThrustHistoryFile</guilabel> and
          <guilabel>ThrustSegment</guilabel> objects that we will
          create.</para>
        </listitem>

        <listitem>
          <para>Create one or more <guilabel>ThrustSegment</guilabel> objects.
          A thrust segment is a block of data inside the file specified by the
          <guilabel>ThrustHistoryFile</guilabel> object, encapsulated between
          "BeginThrust {<guilabel>ThrustSegment</guilabel> object name}" and
          "EndThrust {<guilabel>ThrustSegment</guilabel> object name}"
          keywords. A given thrust history file can contain one or more thrust
          segments. As described in the <xref linkend="ThrustSegment"/> help,
          the <guilabel>ThrustSegment</guilabel> object describes how the
          segment data will be used. The following steps should be
          taken.</para>

          <orderedlist>
            <listitem>
              <para>Set the parameters (scale factor related parameters,
              solve-for related parameters, etc) for the
              <guilabel>ThrustSegment</guilabel>.</para>
            </listitem>

            <listitem>
              <para>(If modeling mass flow), configure the
              <guilabel>ThrustSegment</guilabel> to use the
              <guilabel>ChemicalTank</guilabel> created in Step 2.</para>
            </listitem>
          </orderedlist>
        </listitem>

        <listitem>
          <para>Create a <guilabel>ThrustHistoryFile</guilabel> Object.</para>

          <orderedlist>
            <listitem>
              <para>Use the
              <guilabel>ThrustHistoryFile.AddThrustSegment</guilabel>
              parameter to specify which <guilabel>ThrustSegments,</guilabel>
              created in Step 3, our new
              <guilabel>ThrustHistoryFile</guilabel> object will use.</para>
            </listitem>

            <listitem>
              <para>Specify the actual thrust history file name.</para>
            </listitem>
          </orderedlist>
        </listitem>

        <listitem>
          <para>Create the thrust history file specified in part b of Step 4.
          Refer to the <xref linkend="ThrustHistoryFile"/> Help, which
          contains a description of the file format, as needed.</para>
        </listitem>
      </orderedlist>

      <para>When using the <guilabel>Toggle</guilabel> command in conjunction
      with modeling finite burns in an ephemeris file, a certain order of
      operations must be observed. The ephemeris Toggle commands must be
      placed inside the Begin and EndFileThrust commands as shown in the
      example below. This order of operations must be observed when
      propagating, as well as when running estimators like the
      <guilabel>BatchEstimator</guilabel>,
      <guilabel>ExtendedKalmanFilter</guilabel>, or
      <guilabel>Smoother</guilabel>.</para>

      <programlisting><code>BeginFileThrust ThrustHistory(Sat);
Toggle Ephem On;
Propagate Prop(Sat) {Sat.ElapsedDays = 1};
Toggle Ephem Off;
EndFileThrust ThrustHistory(Sat);</code></programlisting>
    </refsection>

    <refsection>
      <title>BeginFileThrust and EndFileThrust commands are NOT branch
      commands</title>

      <para>The <guilabel>BeginFileThrust</guilabel> and
      <guilabel>EndFileThrust</guilabel> commands are NOT branch commands,
      meaning, a <guilabel>BeginFileThrust</guilabel> command can exist
      without an <guilabel>EndFileThrust</guilabel> command.</para>

      <para>Similarly, since the <guilabel>BeginFileThrust</guilabel> and
      <guilabel>EndFileThrust</guilabel> commands are used to turn on or off
      the thrust/mass and mass flow rate profiles, applying the same command
      multiple times in a script without its inverse is the same as applying
      it once. In other words, if you do this:</para>

      <programlisting><code>BeginFileThrust aThrustHistoryFile(aSat);
BeginFileThrust aThrustHistoryFile(aSat);
BeginFileThrust aThrustHistoryFile(aSat);</code></programlisting>

      <para>The effect is the same as only applying the
      <guilabel>BeginFileThrust</guilabel> command one time. The same holds
      true for the <guilabel>EndFileThrust</guilabel> command.</para>
    </refsection>
  </refsection>

  <refsection>
    <title>Examples</title>

    <refsection>
      <title>Apply a thrust and mass flow rate profile to a
      <guilabel>Spacecraft</guilabel></title>

      <informalexample>
        <para>We will create a sample script to apply a thrust and mass flow
        rate profile to a <guilabel>Spacecraft</guilabel> object. In our
        script, we will create a <guilabel>Spacecraft</guilabel> object,
        <guilabel>aSat</guilabel>, with an initial epoch of '01 Jan 2010
        00:00:00.000.'. We decide that we want to apply a 3 Newton force in
        the Earth Centered Inertial (ECI) X direction for a duration of 100
        seconds starting at '01 Jan 2010 00:01:00.000.' During the same time
        duration, we also want to apply a mass flow rate profile that uses
        fuel at a rate of 0.01 kg/s. Before we run our script, we will need to
        create a thrust history file, with the contents listed below. The user
        should name this file 'SampleThrustFile.thrust' and place it in the
        GMAT 'data' directory.</para>

        <programlisting>BeginThrust {aThrustSegment}
Start_Epoch = 01 Jan 2010 00:00:00.000
Thrust_Vector_Coordinate_System = EarthMJ2000Eq   
Thrust_Vector_Interpolation_Method  = None
Mass_Flow_Rate_Interpolation_Method = None
ModelThrustAndMassRate
60.0      3.0 0.0 0.0  0.01
160.0     3.0 0.0 0.0  0.01
EndThrust {aThrustSegment}</programlisting>

        <para>Below, we create a script that will</para>

        <itemizedlist>
          <listitem>
            <para>Create and configure our needed
            <guilabel>Spacecraft</guilabel>,
            <guilabel>ChemicalTank</guilabel>, <guilabel>Propagator,
            ThrustSegment</guilabel>, and
            <guilabel>T</guilabel><guilabel>hrustHistoryFile</guilabel>
            objects.</para>
          </listitem>

          <listitem>
            <para>Use the <guilabel>BeginFileThrust</guilabel> and
            <guilabel>EndFileThrust</guilabel> commands to apply our desired
            thrust and mass flow rate profile to our
            <guilabel>Spacecraft</guilabel> object,
            <guilabel>aSat</guilabel>.</para>
          </listitem>

          <listitem>
            <para>Create and configure a <guilabel>ReportFile
            </guilabel>object so that we can determine the fuel mass in our
            created <guilabel>ChemicalTank</guilabel> object both before and
            after the desired thrust and mass flow rate profile has been
            applied.</para>
          </listitem>
        </itemizedlist>

        <programlisting>%  Create and configure objects
Create Spacecraft aSat
aSat.DateFormat = UTCGregorian;
aSat.Epoch = '01 Jan 2010 00:00:00.000';

Create ChemicalTank aTank 
aSat.Tanks = {aTank}

Create Propagator aPropagator

Create ThrustSegment aThrustSegment
aThrustSegment.ThrustScaleFactor = 1.2;
aThrustSegment.ApplyThrustScaleToMassFlow = false;
aThrustSegment.MassFlowScaleFactor = 2.0;
aThrustSegment.MassSource = {'aTank'};

Create ThrustHistoryFile aThrustHistoryFile

aThrustHistoryFile.AddThrustSegment = {'aThrustSegment'};
aThrustHistoryFile.FileName = '../data/SampleThrustFile.thrust';

Create ReportFile aReportFile

BeginMissionSequence

Report aReportFile aSat.aTank.FuelMass

BeginFileThrust aThrustHistoryFile(aSat);
  Propagate aPropagator(aSat) {aSat.ElapsedSecs = 180.0};
EndFileThrust aThrustHistoryFile(aSat);

Report aReportFile aSat.aTank.FuelMass</programlisting>

        <para>After running the script above, take a look at the before and
        after values of <guilabel>aTank</guilabel>'s fuel mass to note that
        the mass has decreased by 2 kg. This is the expected result. Recall
        that we apply a mass flow rate profile of 0.01 kg/s for 100 seconds
        starting at '01 Jan 2010 00:01:00.000' and ending at '01 Jan 2010
        00:02:40.000'. 100 seconds multiplied by 0.01 kg/s corresponds to a
        mass drop of 1 kg but we need to remember that
        aThrustSegment.MassFlowScaleFactor=2.0. Thus, the mass flow rate
        specified in the file is doubled to obtain an expected mass drop of 2
        kg.</para>
      </informalexample>
    </refsection>

    <refsection>
      <title>Navigation Applications</title>

      <informalexample>
        <para>In the example above, we focused on applying a thrust and mass
        flow rate profile to a spacecraft in a mission design trajectory
        propagation context. We did this by sandwiching in a
        <guilabel>Propagate</guilabel> command in between a
        <guilabel>BeginFileThrust</guilabel> and
        <guilabel>EndFileThrust</guilabel> command. One can also use
        <guilabel>BeginFileThrust</guilabel> and
        <guilabel>EndFileThrust</guilabel> commands in the context of orbit
        determination. This is done by sandwiching in a
        <guilabel>RunSimulator</guilabel> or a
        <guilabel>RunEstimator</guilabel> command in between a
        <guilabel>BeginFileThrust</guilabel> and
        <guilabel>EndFileThrust</guilabel> command.</para>

        <para>See the sample/Navigation folder for a script,
        Simulate_Continuous_thrust_SolveFor_ScaleFactor.script, that uses the
        <guilabel>BeginFileThrust</guilabel> and
        <guilabel>EndFileThrust</guilabel> commands in an orbit determination
        context. In this script,</para>

        <itemizedlist>
          <listitem>
            <para>We configure two <guilabel>Spacecraft</guilabel>,
            <guilabel>SimSat</guilabel>, and<guilabel> EstSat</guilabel>, in
            Low Earth Orbit to use Range measurements from three
            <guilabel>GroundStations</guilabel> to obtain a navigation
            solution.</para>
          </listitem>

          <listitem>
            <para>The <guilabel>SimSat</guilabel> spacecraft is used to
            generate simulated Range measurements over a 12 hour period.
            During the entire period, a thrust history profile, 20 N in the
            velocity direction, is applied. When we apply this thrust, we use
            a ThrustScaleFactor of 1.0. For this simplified case, we do not
            apply a mass flow rate profile.</para>
          </listitem>

          <listitem>
            <para>The <guilabel>EstSat</guilabel> spacecraft reads in the
            simulated Range measurements generated by the
            <guilabel>SimSat</guilabel> spacecraft. During the entire 12 hour
            period, a thrust history profile, 20 N in the velocity direction,
            is applied, albeit with a different starting value for the
            ThrustScaleFactor. We wish to solve-for the EstSat
            ThrustScaleFactor. We start with an a priori guess,
            ThrustScaleFactor = 0.75, which results in large initial
            residuals. We run the estimation process to show that we both
            converge to a good orbit solution with low measurement residuals
            and that we solve for a ThrustScaleFactor close to the true 1.0
            value.</para>
          </listitem>
        </itemizedlist>
      </informalexample>
    </refsection>
  </refsection>
</refentry>
